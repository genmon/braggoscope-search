{"version":3,"names":["braggoscopeSearchCss","BraggoscopeSearch","this","protocol","partykitHost","startsWith","party","room","handleSubmit","event","preventDefault","query","_a","currentTarget","querySelector","blur","loading","fetchResults","handleQueryChange","target","value","res","fetch","method","headers","body","JSON","stringify","episodes","json","results","splice","render","formatDate","dateString","date","Date","options","year","month","day","formatted","toLocaleDateString","replace","formatScore","score","Math","round","show","document","style","overflow","dismiss","h","Host","onClick","id","class","maxHeight","length","Fragment","onSubmit","e","type","placeholder","onChange","map","episode","key","href","permalink","title","published"],"sources":["src/components/braggoscope-search/braggoscope-search.css?tag=braggoscope-search&encapsulation=shadow","src/components/braggoscope-search/braggoscope-search.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n#overlay {\n  @apply fixed top-0 left-0 right-0 bottom-0 z-10 overscroll-contain;\n  @apply bg-black/50;\n  @apply flex flex-col items-center justify-center;\n  -webkit-backdrop-filter: blur(3px);\n  backdrop-filter: blur(3px);\n  @apply font-sans text-black;\n}\n","import { Component, Host, Fragment, State, Prop, h } from '@stencil/core';\n\ntype Episode = {\n  id: string;\n  title: string;\n  published: string;\n  permalink: string;\n  score: number;\n};\n\n@Component({\n  tag: 'braggoscope-search',\n  styleUrl: 'braggoscope-search.css',\n  shadow: true,\n})\nexport class BraggoscopeSearch {\n  @Prop() partykitHost: string = '127.0.0.1:1999';\n  protocol: string = this.partykitHost.startsWith('localhost') || this.partykitHost.startsWith('127.0.0.1') ? 'http' : 'https';\n  party: string = 'search';\n  room: string = 'braggoscope';\n  @State() show: boolean = false;\n  @State() query: string = '';\n  @State() results: Episode[] = [];\n  @State() loading: boolean = false;\n\n  private handleSubmit(event) {\n    event.preventDefault();\n    if (!this.query) return;\n    // blur the form\n    event.currentTarget.querySelector('input')?.blur();\n    this.loading = true;\n    this.fetchResults();\n  }\n\n  private handleQueryChange(event) {\n    this.query = event.target.value;\n  }\n\n  private async fetchResults() {\n    const res = await fetch(`${this.protocol}://${this.partykitHost}/parties/${this.party}/${this.room}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ query: this.query }),\n    });\n\n    const { episodes } = await res.json();\n    this.results = episodes.splice(0, 10);\n    this.loading = false;\n  }\n\n  render() {\n    const formatDate = (dateString: string) => {\n      // dateString is like \"2021-05-27\" and we want \"27 May, 2021\"\n      // Ensure there is a comma before the year\n      const date = new Date(dateString);\n      const options = { year: 'numeric', month: 'short', day: 'numeric' } as Intl.DateTimeFormatOptions;\n      const formatted = date.toLocaleDateString('en-GB', options);\n      // replace the final space ONLY with a comma\n      return formatted.replace(/ ([^ ]*)$/, ', $1');\n    };\n\n    const formatScore = (score: number) => {\n      // score is like 0.123456789 and we want 12.3%\n      return `${Math.round(score * 1000) / 10}%`;\n    };\n\n    const show = () => {\n      document.body.style.overflow = 'hidden';\n      this.show = true;\n    };\n\n    const dismiss = () => {\n      this.query = '';\n      this.results = [];\n      document.body.style.overflow = 'auto';\n      this.show = false;\n    };\n\n    return (\n      <Host>\n        <button onClick={show}>\n          <slot></slot>\n        </button>\n        {this.show && (\n          <div id=\"overlay\">\n            <div class=\"absolute top-0 bottom-0 left-0 right-0\" onClick={dismiss} />\n            <div class=\"relative flex flex-col justify-start items-center gap-6 w-full max-w-md p-4\" style={{ maxHeight: '100dvh' }}>\n              {this.results.length === 0 && (\n                <Fragment>\n                  <form onSubmit={e => this.handleSubmit(e)} class=\"w-full flex flex-wrap sm:flex-no-wrap justify-stretch items-center gap-1\">\n                    <input\n                      class=\"w-full sm:w-auto sm:grow border border-gray-300 rounded-sm px-3 py-3 text-xl\"\n                      type=\"text\"\n                      placeholder=\"e.g. greek mythology\"\n                      value={this.query}\n                      onChange={e => this.handleQueryChange(e)}\n                    />\n                    <button class=\"relative w-full sm:grow-0 sm:w-fit bg-white border border-blue-500 hover:bg-blue-100 px-6 py-3 text-xl text-blue-500 rounded\" type=\"submit\">\n                      Search\n                      {this.loading && (\n                        <div class=\"absolute top-0 left-0 bottom-0 right-0 w-full h-full bg-blue-100 font-normal text-blue-400 flex justify-center items-center cursor-wait\">\n                          Loading...\n                        </div>\n                      )}\n                    </button>\n                  </form>\n                  <div class=\"w-full justify-center\">\n                    <button class=\"mx-auto flex justify-center items-center text-white/90 gap-1\" onClick={dismiss}>\n                      <span>&times;</span>\n                      <span class=\"underline\">Close</span>\n                    </button>\n                  </div>\n                </Fragment>\n              )}\n              {this.results.length > 0 && (\n                <div class=\"flex flex-col justify-start items-start gap-6 w-full rounded-sm bg-white p-4 overflow-y-scroll\">\n                  <div class=\"w-full flex justify-between\">\n                    <button\n                      class=\"underline\"\n                      onClick={() => {\n                        this.results = [];\n                      }}\n                    >\n                      &larr; Search again\n                    </button>\n                    <button class=\"flex justify-center items-center gap-1 underline\" onClick={dismiss}>\n                      Close\n                    </button>\n                  </div>\n                  <div class=\"flex w-full justify-stretch items-center gap-2 text-2xl\">\n                    <div class=\"grow-0 font-semibold\">Episodes:</div>\n                    <div class=\"grow-1 truncate\">{this.query}</div>\n                  </div>\n                  <ul class=\"flex flex-col justify-start items-start gap-2\">\n                    {this.results.map(episode => {\n                      return (\n                        <li key={episode.id} class=\"leading-normal\">\n                          <a class=\"text-blue-500 font-bold underline\" href={`https://www.braggoscope.com${episode.permalink}`}>\n                            {episode.title}\n                          </a>{' '}\n                          <span class=\"text-gray-400 text-xs\">(score: {formatScore(episode.score)})</span>\n                          <br />\n                          <span class=\"text-gray-400\">{formatDate(episode.published)}</span>\n                        </li>\n                      );\n                    })}\n                  </ul>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </Host>\n    );\n  }\n}\n"],"mappings":"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"}